\chapter{Part 2 -- Network Configuration and Analysis}
% Repeat for each experiment (1 to 6)
\section{Experiment 1 - Configure an IP Network}
\subsection{Network Architecture}
For this experiment, we connected TUX3 and TUX4 through the switch and 
configured their IP addresses as requested in the project description.
\subsection{Objectives}
State the learning objectives.
\subsection{Main Configuration Commands}
List the main commands/scripts used.
\subsection{Relevant Logs}
Show relevant logs and outputs.
\subsection{Analysis}
Discuss the results and learning points.

\section{Experiment 2 - Implement two bridges in a switch}
\subsection{Network Architecture}
Describe the network setup for this experiment.
\subsection{Objectives}
State the learning objectives.
\subsection{Main Configuration Commands}
List the main commands/scripts used.
\subsection{Relevant Logs}
Show relevant logs and outputs.
\subsection{Analysis}
Discuss the results and learning points.

\section{Experiment 3 - Configure a Router in Linux}
\subsection{Network Architecture}
Describe the network setup for this experiment.
\subsection{Objectives}
State the learning objectives.
\subsection{Main Configuration Commands}
List the main commands/scripts used.
\subsection{Relevant Logs}
Show relevant logs and outputs.
\subsection{Analysis}
Discuss the results and learning points.

\section{Experiment 4 - Configure a Commercial Router and Implement NAT}
\subsection{Configuring a Static Route in a Commercial Router}
To configure a static route in the commercial router, we accessed its 
console and entered the necessary commands. We added a new static route with the destination network, subnet mask, and gateway as per the project requirements. After saving the configuration, we verified the route was correctly added by checking the routing table in the router's interface.
\subsection{ICMP Redirection}
To test \ac{ICMP} redirection, we initiated ping requests from TUX2 to TUX3.
Initially, the packets were routed through TUX4 as it was the shortest path to subnet 172.16.Y0.0/24. After that, as requested in the project description, we disabled redirection acceptance on TUX2, and changed the routes to force the packets to go through the commercial router. This way, we observed that TUX2 continued to send packets through TUX4, ignoring the \ac{ICMP} redirect messages from the commercial router.
With \ac{ICMP} redirection disabled, after the first \ac{ICMP} redirect, TUX2 switched to its original routing path, demonstrating the effect of disabling \ac{ICMP} redirect acceptance on the routing behavior of the host.
\subsection{Configuring Network Address Translation}
As \ac{NAT} was already enabled by default on the commercial router, to understand its functionality, we disabled it through the router's console and observed its effects on the network communication. We then re-enabled \ac{NAT} to restore normal operation.
\subsection{Network Address Translation}
To understand \ac{NAT} functionality, we performed ping tests from TUX3 to the \ac{FTP} server before and after disabling \ac{NAT} on the commercial router. With \ac{NAT} enabled, TUX3 was able to successfully ping the server, as the router correctly translated the private \ac{IP} address of TUX3 to a public \ac{IP} address for communication. With \ac{NAT} disabled, the pings failed, indicating that the server could not reach TUX3's private \ac{IP} address directly. This demonstrated the importance of \ac{NAT} in allowing devices within a private network to communicate with external networks.

\section{Experiment 5 - Domain Name System (DNS)}
\subsection{Configuring a DNS Service}
To configure the DNS service on TUX2, TUX3, and TUX4, we modified the 
\texttt{/etc/resolv.conf} file on each machine to include the \ac{IP} address of the \ac{FTP} server \texttt{services.netlab.fe.up.pt}. This allowed the machines to resolve the domain name to its corresponding \ac{IP} address when attempting to connect to the \ac{FTP} server. 
\subsection{DNS Packets}
\ac{DNS} packets were captured using Wireshark while performing a domain name resolution for \texttt{google.com} from TUX3. The captured packets showed the standard \ac{DNS} query and response process, including the query sent by TUX3 to the DNS service and the corresponding response containing the resolved \ac{IP} address of the server.

\section{Experiment 6 - TCP Connections}
\subsection{TCP Connections in FTP}
In order to successfully download a file using the \ac{FTP} client, two \ac{TCP} connections are established between the client and the server. The first connection is the control connection, which is used for sending commands and receiving responses. This connection is established on port 21 of the server. The second connection is the data connection, which is used for transferring files. Depending on whether active or passive mode is used, this connection can be initiated by either the client or the server on a dynamically assigned port.
Every \ac{TCP} connection involves a three-way handshake process to establish the connection, followed by data transfer, and finally a four-way handshake to terminate the connection.

\subsection{Automatic Repeat reQuest in TCP}
\ac{ARQ} is a fundamental mechanism used in \ac{TCP} to ensure reliable data transmission. It works by requiring the receiver to send acknowledgments (ACKs) back to the sender for the data packets received. If the sender does not receive an acknowledgment within a specified timeout period, it assumes that the packet was lost or corrupted and retransmits the packet. This process continues until the sender receives an acknowledgment for all sent packets, ensuring that all data is correctly received by the receiver. On duplicate ACKs, \ac{TCP} can also perform fast retransmissions to improve efficiency.

The following table summarizes the key \ac{TCP} header fields involved in the \ac{ARQ} mechanism and their roles:
\begin{table}[h!]
    \centering
    \begin{tabular}{|p{4cm}|p{10cm}|}
        \hline
        \textbf{Field} & \textbf{Role in ARQ} \\
        \hline
        Sequence Number & Identifies the \textbf{first byte} in this segment. Used for ordering and retransmission. \\
        \hline
        Acknowledgment Number & Indicates \textbf{next byte expected} by the receiver. Confirms receipt of previous bytes. \\
        \hline
        Flags & Especially \textbf{ACK}, \textbf{SYN}, \textbf{FIN}. ACK is critical for ARQ. \\
        \hline
        Window Size & Flow control; tells sender how many bytes can be sent before receiving an ACK. \\
        \hline
        Checksum & Detects corrupted segments; segments failing the checksum are discarded and retransmitted. \\
        \hline
    \end{tabular}
    \caption{TCP Header Fields and Their Role in ARQ}
    \label{tab:tcp-arq-fields}
\end{table}

\subsection{TCP Congestion Control}
\ac{TCP} employs several congestion control mechanisms to manage network congestion and ensure efficient data transmission. The primary algorithms used in \ac{TCP} congestion control include Slow Start, Congestion Avoidance, Fast Retransmit, and Fast Recovery.

The following table highlights the main \ac{TCP} header fields relevant to congestion control and their roles:

\begin{table}[h!]
    \centering
    \begin{tabular}{|p{4cm}|p{10cm}|}
        \hline
        \textbf{Field} & \textbf{Role} \\
        \hline
        Sequence Number & Tracks the byte position for retransmission and ordering. \\
        \hline
        Acknowledgment Number & Confirms receipt of bytes; triggers congestion window (cwnd) increase. \\
        \hline
        Window Size (rwnd) & Receiverâ€™s advertised window (flow control). \\
        \hline
        Flags (ACK) & ACK signals successful receipt. \\
        \hline
        Optional TCP Options & e.g., SACK (Selective ACK) can improve fast retransmit. \\
        \hline
    \end{tabular}
    \caption{TCP Header Fields and Their Role in Congestion Control}
    \label{tab:tcp-congestion-fields}
\end{table}

To measure the effects of the \ac{TCP} congestion control mechanism, we initiated a file download using our \ac{FTP} client while capturing the \ac{TCP} packets with Wireshark. By analyzing the captured packets, we observed the changes in the throughput during the concurrent download process, as can be seen in Figure~\ref{fig:tcp_congestion}.


